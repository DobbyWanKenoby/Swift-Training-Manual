# Интернационализация и локализация

Хcode имеет ряд технологий, которые позволяют создавать интернационализированные и локализованные приложения. 

Локализация приложения достигается благодаря тому, что текстовый контент, предназначенный для пользователя, может быть отделен от графического представления приложения. Кроме того в составе проекта могут содержаться различные ресурсы (включая медиа, storyboards, xib и т.д.) для каждого из поддерживаемых языков.

> Вопросы интернационализации рассматриваются в разделах с описание соответствующих функциональных элементов (например класса `Calendar`). В данном документе описываются вопросы локализации.

### Определения

__Интернационализация__ - это процесс разработки приложения, при котором добавляется поддержка форматов календаря, валют, времени, дат, чисел, часового пояса и т.д., а так же обеспечивается ввод и вывод текста на родном для пользователя языке.

__Локализация__ - это процесс перевода строкового и иного (в том числе медиа) контента на язык пользователя.

__Base internationalization__ - функция, выполняющая следующие функции:

- создает в составе проекта папку `Base.lproj`, содержащую общие базовые элементы (файлы, storyboard, медиа), которые загружаются при отсутствии их локализованной для пользовательского языка версии.

- позволяет выделить из storyboard и xib файлов в отдельный файл их текстовое содержимое, которое может быть локализовано независимо от самого storyboard и xib файлы и в дальнейшем использовано совместно с ним. То есть будет загружаться storyboard-файла, а его текстовое наполнение из соответсвующего дополнительного локализованного файла.

__Development language__ - язык разработки. Основной язык, на котором ведется разработка приложения.

__Предпочитаемые языки__ - список языков, добавленных пользователем в настройках устройства в разделе `Основные` - `Язык и Регион`.

__Поддерживваемые языки__ - список языков, добаввленных разработчиком при локализации приложения. Для каждого языка в составе проекта создается папка собственная папка для хранения локализованных файлов:

- `en.lproj` для английского;
- `ru.lproj` для русского;

и т.д.

> Функция Base internationalization и список поддерживаемых языков - это две независимые функции

### Пример

В проекте активирована функция `Base internationalization`, а также добавлены языки `English` (Development language) и `Russian`. 

В составе проект есть 3 файла:

- `LaunchScreen.storyboard`, для которого не активирована функция локализации;
- `Main.storyboard`, для которого активирована локализация и есть версии для обоих языков.
- `Logo.png`, для которого активирована локализация, но есть версия только для английского языка.

В результате в составе проекта __может__ находиться следующая структура файлов и папок:

- `LaunchScreen.storyboard`
- `Base.lproj`
 - / `Main.storyboard`
 - / `Logo.png`
- `en.lproj`
- `ru.lproj`
 - / `Main.storyboard`

> В данной структуре показано, что в файл `Main.storyboard` имеет несколько копий. При этом каждая из копий может иметь уникальное содержимое. Но также возможен вариант, когда при использовании `Base internationalization` будет всего одна копия `Main.storyboard`, но в соответствующих папках будут локализованные файлы с текстовым содержимым `Main.strings`.

## Активация функции локализации

### Активация `Base internationalization`

Рекомендуется в каждом проекте активировать данную функцию.

- Открыть настройки проекта.
- Открыть раздел `Info`. 
- В разделе `Localization` отметить пункт `Use Base internationalization`.
- В открывшемся окне выберите для каких файлов необходимо создать базовую версию и на основе какого языка.

### Поддерживаемые языки

Для добавления нового языка:
- Открыть настройки проекта.
- Открыть раздел `Info`. 
- В разделе `Localization` нажать кнопку `+`.
- В выпадающем окне выбрать язык.
- В открывшемся окне выбрать локализуемые файлы и тип локализации (для storyboard и xib).

### Локализация ресурса

Если в приложении добавлены несколько языков, то для активации вновь созданного ресурса (файла, картинки, видео, storyboard и т.д.:

- Выделить данный ресурс в `Project Navigator`.
- На панели `File Inspector` (справа) нажать кнопку `Localize...`.
- Выбрать поддерживаемые ресурсом языки.



## Локализация текста

Для локализации текстовых данных в файлах с исходным кодом `.swift` используется специальный файл `Localizable.strings`.

### Создание `Localizable.strings`

- Добавить в проект новый файл типа `Stings` с названием `Localizable.strings`.
- Выделить данный файл и на панели `File Inspector` (справа) нажать кнопку `Localize...`.
- Выбрать поддерживаемые языки.

После этого в составе проекта отобразятся локализованные версии файла `Localizable.strings`, для активированных языков.

При этом для в каждом из файлов могут содержаться словарь "ключ - значение", значения которого могут быть получены которые в коде с помощью специального класса `NSLocalizedString ` с указанием ключа.

При этом, если какого-то элемента с определенным ключом нет в варианте `Localizable.strings`, соответствующем пользовательскому языку, то будет показано значение из варианта `Localizable.strings`, соответствующего языку разработки. Если его нет и там, то вместо строкового значения будет выведен указанный ключ. 

### Использование `Localizable.strings`

#### Простые значения

Значения в файле `Localizable.strings` хранятся в виде словаря

```swift
 "key" = "value";
 "anotherKey" = "value";
```
Для их использования в коде вместо конкретной строки необходимо использовать

```swift
NSLocalizedString("key", comment: "")
```

#### Значения с подстановкой

Можно локализовать значения, передавая в них доп параметры.

__Подставновка числа__

```swift
Localizable.strings:

"key %d" = "value %d";
```

```swift
Файл с исходным кодом:

String(format: NSLocalizedString("key %d", comment: ""), 12)
```
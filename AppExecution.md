# Запуск и функционирование приложения

[К содержанию](./README.md)

## Содержание

- [Запуск приложения](./AppExecution.md#start)
- [Процессы](#processes)
- [Потоки и многопоточность](./Thearding.md)
- [Управление памятью в iOS](./MemoryManagement.md)
- [RunLoop](./RunLoop.md)
- [Objective-C Runtime](./ObjectiveCRuntime.md)

## <a id="launch"></a>Запуск приложения

Процесс запуска приложения в операционной системе iOS состоит из следюущих шагов (большую часть из них автоматически выполняет UIKit).

1. Запрос на запуск приложения. Его может создать пользователь (например, когда тапает по иконке приложения) или операционная система (например, когда поступает push).
1. Происходит запуск функции `UIApplicationMain(_:_:_:_:)`.
1. Создается экземпляр типа `UIApplication`, соответсвующий приложению, и его делегат `AppDelegate`.
> Одному приложению всегда соответсвует только один экземпляр `UIApplication`.

1. Если у приложения есть стандартный storyboard-файл, то происходит его загрузка. 
1. Вызовается метод `application(_:willFinishLaunchingWithOptions:)`.
1. Вызывается метод `application(_:didFinishLaunchingWithOptions:)`.
1. Создает делегат сцены `SceneDelegate`.
1. Вызывается метод `scene(_:willConnectTo:options:)`, в котором создается экземпляр окна `UIWindow` и происходит загрузка интерфейса.

## <a id="processes"></a>Процессы

После запуска приложения в операционной системе создается процесс, для которого в оперативной памяти выделяется пространство (виртуальное адресное пространство).

__Процесс__ - абстракция, объединяющее в себе независимое виртуальное адресное пространство в оперативной памяти и дополнительные ресурсы (например файлы).

__Процесс__ - это экземпляр запущенного приложения.

Обычно запущенному приложению соответствует один процесс, но в некоторых случаях разработчиком (не под iOS) может быть реализована иной подход. Так, например, браузер Google Chrome для каждой вкладки создает отдельный процесс, чтобы исключить возможность взаимодействия вкладок между собой.

>
> В iOS для одного приложения всегда создается только один процесс.
>

Процессы по умолчанию не могут взаимодействовать между собой и для организации этого взаимодействия требуется использовать дополнительные возможности, вроде общих файлов, сокетов (socket), портов (port). Так же в зависимости от используемой платформы могут быть доступны другие средства обмена. В iOS можно использовать Pipe, App Groups, Share Extension, Custom URL Scheme и другие (подробнее в ["Передача данных между приложениями"](/PassDataProcesses.md)).

В iOS и macOS все пользовательские процессы создаются процессом с названием `launchd` (PID = 1). Для создания дочерних процессов в macOS можно использовать класс `Process`. В iOS нет возможности самостоятельно создавать дочерние процессы.

После запуска в рамках процесс создается главный поток ([thread](/Thearding.md)), в рамках которого автоматически запускается [RunLoop](/RunLoop.md) и в дальнейшем выполняются все инструкции.

В текущее время, так как iOS и приложения, написанные на Swift, все еще во многом функционируют за счет библиотек, написанных на Objective-C, в памяти устройства находится [Objective-C Runtime](/ObjectiveCRuntime.md) - библиотека времени исполнения, обеспечивающая доступ ко многим функциональным возможностям операционной системы. Один из знакомых вам вариантов взаимодействия с ней является использование аттрибута [`@objc`](/ObjectiveCRuntime.md#objc).
